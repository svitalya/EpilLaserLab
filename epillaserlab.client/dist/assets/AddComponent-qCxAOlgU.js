import{d as A,A as U,u as V,s as M,i as c,r as b,_ as F,o as n,c as l,a as s,w as d,y as h,F as m,h as p,v as w,l as G,t as r}from"./index-BSdrrqya.js";const $=A({async beforeCreate(){fetch("/api/clients?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async e=>{let a=(await e.json()).data.recs;this.clientsData=a,this.data.clientId=a[0].clientId}),fetch("/api/services?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async e=>{let a=(await e.json()).data.recs;this.servicesData=a,this.data.serviceId=a[0].serviceId,this.timeCost=await this.getTimeCostService()}),fetch("/api/types?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async e=>{let a=(await e.json()).data.recs;this.typesData=a,this.data.typeId=a[0].id}),fetch("/api/categories?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async e=>{let a=(await e.json()).data.recs;this.categories=a,this.data.categoryId=a[0].id}),fetch("/api/branches?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async e=>{let a=(await e.json()).data.recs;this.branches=a,this.data.branchId=a[0].branchId,await this.branchChange(),this.$forceUpdate()})},setup(){U();const e=V(),a=M(),_=c([{clientId:0,name:null}]),T=c([{serviceId:0,name:null}]),S=c([{id:0,name:null}]),D=c([{id:0,name:null}]),t=c([{branchId:0,address:null}]);let I=b([{masterId:null,fio:""}]),f=b([{scheduleId:null,dateString:""}]),j=b({intervalString:""}),v=0;const i=c({clientId:null,serviceId:null,typeId:null,categoryId:null,branchId:null,masterId:null,scheduleId:null,timeStart:null,client:{name:null,phone:null}}),g=c({val:!0}),E=()=>g.val=!g.val,k=async()=>{fetch(`/api/masters?limit=1000&branchId=${i.branchId??-1}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async u=>{let o=(await u.json()).data.recs;o.length>0?(I.value=o,i.masterId=o[0].masterId??null):(I.value=[],i.masterId=null),await B()})},B=async()=>{fetch(`/api/schedules?limit=1000&masterId=${i.masterId??-1}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async u=>{let o=(await u.json()).data.recs;o.length>0?(f.value=o,i.scheduleId=o[0].scheduleId??null):(f.value=[],i.scheduleId=null),v=await C(),await y()})},y=async()=>{fetch(`/api/intervals/${i.scheduleId??-1}?timeCost=${v}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async u=>{j.value.intervalString=(await u.json()).intervalsString??"Нет графика"})},C=async()=>{let u=[];await fetch("/api/services?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async o=>{u=(await o.json()).data.recs});for(let o of u)if(o.serviceId==i.serviceId)return o.timeCost};return{data:i,clientsData:_,servicesData:T,typesData:S,categories:D,branches:t,masters:I,branchChange:k,changeMaster:B,scheduls:f,intervals:j,changeSchedule:y,timeCost:v,getTimeCostService:C,changeService:async()=>{v=await C(),await y()},clickBtn:async()=>{i.client.name&&i.client.phone?i.clientId=null:i.client=null,console.log(i.clientId),await fetch("/api/applications",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(async u=>{let o=await u.json();o.message=="OK"?(e.success("Запись успешно добавлена"),a.push({name:"dashboard.home"})):o.message=="DUPLICATION"||o.message=="DUPLICATION"?e.error("Дублирование записи"):o.message=="NOT CHANGED"?e.info("Внесите изменения"):o.message=="DATA NOT VALID"||o.status==400?e.error("Введите значения"):e.error("Ошибка при добавлении записи")})},clientSelected:g,plusMinusBtnClickHandler:E}}}),N=s("div",{class:"flex-column"},[s("h1",{class:"row h3"}," Создать запись заявки ")],-1),O={class:"row form-group mt-3"},H=s("label",{class:"h5"},"Клиент",-1),L={key:0,class:"col-8"},P=["value"],z={key:1,class:"col-8"},J={class:"row"},K=s("label",{class:"h5"},"Введите имя",-1),R={class:"col-12"},q={class:"row"},Q=s("label",{class:"h5"},"Введите телефон",-1),W={class:"col-12"},X={class:"col-4"},Y={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus",viewBox:"0 0 16 16"},Z={key:0,d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"},x={key:1,d:"M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"},ee={class:"row form-group mt-3"},te=s("label",{class:"h5"},"Услуга",-1),se={class:"col-12"},ae=["value"],ne={class:"row form-group mt-3"},le=s("label",{class:"h5"},"Прайс лист",-1),oe={class:"col-12"},ie=["value"],ue={class:"row form-group mt-3"},de=s("label",{class:"h5"},"Категория",-1),re={class:"col-12"},ce=["value"],he={class:"row form-group mt-3"},me=s("label",{class:"h5"},"Филиал",-1),pe={class:"col-12"},ve=["value"],Ie={class:"row form-group mt-3"},fe=s("label",{class:"h5"},"Мастер",-1),ge={class:"col-12"},ye=["value"],Ce={class:"row form-group mt-3"},be=s("label",{class:"h5"},"Дни работы",-1),we={class:"col-12"},_e=["value"],Te={class:"row form-group mt-3"},Se=s("label",{class:"h5"},"Доступное время",-1),De={class:"col-12"},je=["value"],Be={class:"row form-group mt-3"},Ee=s("label",{class:"h5"},"Введите время",-1),ke={class:"col-12"},Ae=s("div",{class:"row mt-4"},[s("button",{type:"submit",class:"btn btn-success me-3",style:{width:"120px"}},"Сохранить")],-1);function Ue(e,a,_,T,S,D){return n(),l("div",null,[N,s("form",{onSubmit:a[15]||(a[15]=G((...t)=>e.clickBtn&&e.clickBtn(...t),["prevent"]))},[s("div",O,[H,e.clientSelected.val?(n(),l("div",L,[d(s("select",{class:"form-control","onUpdate:modelValue":a[0]||(a[0]=t=>e.data.clientId=t)},[(n(!0),l(m,null,p(e.clientsData,t=>(n(),l("option",{value:t.clientId},r(t.name),9,P))),256))],512),[[h,e.data.clientId]])])):(n(),l("div",z,[s("div",J,[K,s("div",R,[d(s("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=t=>e.data.client.name=t),class:"form-control"},null,512),[[w,e.data.client.name]])])]),s("div",q,[Q,s("div",W,[d(s("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=t=>e.data.client.phone=t),class:"form-control"},null,512),[[w,e.data.client.phone]])])])])),s("div",X,[s("button",{type:"button",class:"btn btn-secondary",onClick:a[3]||(a[3]=(...t)=>e.plusMinusBtnClickHandler&&e.plusMinusBtnClickHandler(...t))},[(n(),l("svg",Y,[e.clientSelected.val?(n(),l("path",Z)):(n(),l("path",x))]))])])]),s("div",ee,[te,s("div",se,[d(s("select",{class:"form-control","onUpdate:modelValue":a[4]||(a[4]=t=>e.data.serviceId=t),onChange:a[5]||(a[5]=(...t)=>e.changeService&&e.changeService(...t))},[(n(!0),l(m,null,p(e.servicesData,t=>(n(),l("option",{value:t.serviceId},r(t.name)+" - "+r(t.timeCost)+"мин.",9,ae))),256))],544),[[h,e.data.serviceId]])])]),s("div",ne,[le,s("div",oe,[d(s("select",{class:"form-control","onUpdate:modelValue":a[6]||(a[6]=t=>e.data.typeId=t)},[(n(!0),l(m,null,p(e.typesData,t=>(n(),l("option",{value:t.id},r(t.name),9,ie))),256))],512),[[h,e.data.typeId]])])]),s("div",ue,[de,s("div",re,[d(s("select",{class:"form-control","onUpdate:modelValue":a[7]||(a[7]=t=>e.data.categoryId=t)},[(n(!0),l(m,null,p(e.categories,t=>(n(),l("option",{value:t.id},r(t.name),9,ce))),256))],512),[[h,e.data.categoryId]])])]),s("div",he,[me,s("div",pe,[d(s("select",{class:"form-control","onUpdate:modelValue":a[8]||(a[8]=t=>e.data.branchId=t),onChange:a[9]||(a[9]=(...t)=>e.branchChange&&e.branchChange(...t))},[(n(!0),l(m,null,p(e.branches,t=>(n(),l("option",{value:t.branchId},r(t.address),9,ve))),256))],544),[[h,e.data.branchId]])])]),s("div",Ie,[fe,s("div",ge,[d(s("select",{class:"form-control","onUpdate:modelValue":a[10]||(a[10]=t=>e.data.masterId=t),onChange:a[11]||(a[11]=(...t)=>e.changeMaster&&e.changeMaster(...t))},[(n(!0),l(m,null,p(e.masters,t=>(n(),l("option",{value:t.masterId},r(t.fio),9,ye))),256))],544),[[h,e.data.masterId]])])]),s("div",Ce,[be,s("div",we,[d(s("select",{class:"form-control","onUpdate:modelValue":a[12]||(a[12]=t=>e.data.scheduleId=t),onChange:a[13]||(a[13]=(...t)=>e.changeSchedule&&e.changeSchedule(...t))},[(n(!0),l(m,null,p(e.scheduls,t=>(n(),l("option",{value:t.scheduleId},r(t.dateString),9,_e))),256))],544),[[h,e.data.scheduleId]])])]),s("div",Te,[Se,s("div",De,[s("textarea",{type:"text",value:e.intervals.intervalString,class:"form-control",disabled:""},null,8,je)])]),s("div",Be,[Ee,s("div",ke,[d(s("input",{type:"text","onUpdate:modelValue":a[14]||(a[14]=t=>e.data.timeStart=t),class:"form-control"},null,512),[[w,e.data.timeStart]])])]),Ae],32)])}const $e=F($,[["render",Ue]]);export{$e as default};
