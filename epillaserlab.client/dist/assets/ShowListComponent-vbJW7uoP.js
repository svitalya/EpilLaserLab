import{d as E,s as L,u as O,r as C,_ as S,e as f,o as j,c as x,f as i,m as u,x as _,a as h,t as I}from"./index-BSdrrqya.js";import{I as N,O as K,D as P}from"./style-CIU-wI-C.js";const V=E({components:{TableBody:N,TableHead:K,DataTable:P},setup(){const a=L(),r=O(),y=window.location.hostname,m=C([]),s=C({}),o=C({}),c=e=>e.target.parentNode.dataset.id,g=async e=>{let t=c(e);await a.push({name:"dashboard.branches.edit",params:{id:t}})},p=async e=>{if(!confirm("Вы точно хотите удалить запись?"))return;let d=c(e);await fetch(`/api/branches/${d}`,{method:"DELETE",credentials:"include"}).then(async n=>{const l=await n.json();l.message=="OK"?(r.success("Запись удалена"),b(void 0)):l.message=="BLOCK"?r.error("Удаление записи приведет к потере данных"):r.error("Ошибка при удалении записи")}).catch(n=>a.push({name:"dashboard"}))},b=async e=>{let t,d,n,l;n=o.value.sort,typeof e=="string"?(t=s.value.page,d=s.value.limit,n=n=="asc"?"desc":"asc",l=e.split(":")[0],l!==o.value.order&&(n="desc")):typeof e==typeof{}?(t=e.page-1<0?0:e.page-1,d=e.per_page,l=o.value.order):(t=s.value.page,d=s.value.limit,l=o.value.order);let w={page:t,limit:d,sort:n,order:l};var T=new URLSearchParams(w);await fetch(`/api/branches?${T}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async D=>{let k=await D.json();if(k.message="OK"){let v=k.data,B=v.max;t=v.page;let $=v.recs;m.value=$,s.value={...s.value,page:t,total:B,limit:d},o.value={...o.value,sort:n,order:l}}else m.value=[],s.value={...s.value,page:0,total:0,limit:d},o.value={...o.value,sort:n,order:l}}).catch(D=>a.push({name:"dashboard"}))};return{tableData:m,pagination:s,loadData:b,sort:o,delClick:p,editClick:g,hostname:y}}}),R=V,z=["src"],F=h("TableBodyCell",{class:"d-flex justify-content-center",colspan:"2"}," Нет записей ",-1);function H(a,r,y,m,s,o){const c=f("table-head"),g=f("router-link"),p=f("table-body"),b=f("data-table");return j(),x("div",null,[i(b,{rows:a.tableData,pagination:a.pagination,sort:a.sort,striped:"",onLoadData:a.loadData,style:{"font-size":"large !important"}},{thead:u(()=>[i(c,null,{default:u(()=>[_("Изображение")]),_:1}),i(c,{sortable:"address",onSorting:a.loadData},{default:u(()=>[_("Адресс")]),_:1},8,["onSorting"]),i(c,null,{default:u(()=>[i(g,{to:{name:"dashboard.branches.add"},tag:"button",type:"button",class:"btn btn-success"},{default:u(()=>[_("Добавить")]),_:1})]),_:1})]),tbody:u(({row:e})=>[i(p,null,{default:u(()=>[h("img",{src:`/resources/images/${e.photoPath}`,width:"150px",height:"150px"},null,8,z)]),_:2},1024),i(p,{textContent:I(e.address)},null,8,["textContent"]),i(p,{"data-id":e.branchId},{default:u(()=>[h("button",{type:"button",class:"btn btn-primary me-2",onClick:r[0]||(r[0]=(...t)=>a.editClick&&a.editClick(...t))},"ИЗМЕНИТЬ"),h("button",{type:"button",class:"btn btn-danger",onClick:r[1]||(r[1]=(...t)=>a.delClick&&a.delClick(...t))},"УДАЛИТЬ")]),_:2},1032,["data-id"])]),empty:u(()=>[F]),_:1},8,["rows","pagination","sort","onLoadData"])])}const A=S(R,[["render",H]]);export{A as default};
