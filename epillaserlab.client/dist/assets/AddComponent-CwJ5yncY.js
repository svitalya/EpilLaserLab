import{d as V,B as A,b as M,u as F,a as h,r as f,_ as G,o as n,c as l,e as s,w as r,z as m,F as p,j as v,v as _,f as $,m as N,t as c}from"./index-DEormJ4l.js";import{U as O}from"./UserStore-BqrtbZif.js";const H=V({async beforeCreate(){fetch("/api/clients?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async a=>{let i=(await a.json()).data.recs;this.clientsData=i,this.data.clientId=i[0].clientId}),fetch("/api/services?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async a=>{let i=(await a.json()).data.recs;this.servicesData=i,this.data.serviceId=i[0].serviceId,this.timeCost=await this.getTimeCostService()}),fetch("/api/types?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async a=>{let i=(await a.json()).data.recs;this.typesData=i,this.data.typeId=i[0].id}),fetch("/api/categories?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async a=>{let i=(await a.json()).data.recs;this.categories=i,this.data.categoryId=i[0].id});var t=await O.user();t.roleId==2?(this.data.branchId=t.admin.branchId,this.showBranch=!1,await this.branchChange()):fetch("/api/branches?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async a=>{let i=(await a.json()).data.recs;this.branches=i,this.data.branchId=i[0].branchId,await this.branchChange(),this.$forceUpdate()})},setup(){A();const t=M(),a=F(),i=h([{clientId:0,name:null}]),T=h([{serviceId:0,name:null}]),S=h([{id:0,name:null}]),D=h([{id:0,name:null}]),e=h([{branchId:0,address:null}]);let g=f([{masterId:null,fio:""}]),y=f([{scheduleId:null,dateString:""}]),B=f({intervalString:""}),I=0;const E=f(!0),d=h({clientId:null,serviceId:null,typeId:null,categoryId:null,branchId:null,masterId:null,scheduleId:null,timeStart:null,client:{name:null,phone:null}}),w=h({val:!0}),k=()=>w.val=!w.val,U=async()=>{fetch(`/api/masters?limit=1000&branchId=${d.branchId??-1}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async u=>{let o=(await u.json()).data.recs;o.length>0?(g.value=o,d.masterId=o[0].masterId??null):(g.value=[{fio:"Нет записей",masterId:null}],d.masterId=null),await j()})},j=async()=>{fetch(`/api/schedules?limit=1000&masterId=${d.masterId??-1}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async u=>{let o=(await u.json()).data.recs;o.length>0?(y.value=o,d.scheduleId=o[0].scheduleId??null):(y.value=[{scheduleId:null,dateString:"Нет записей"}],d.scheduleId=null),I=await b(),await C()})},C=async()=>{fetch(`/api/intervals/${d.scheduleId??-1}?timeCost=${I}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async u=>{B.value.intervalString=(await u.json()).intervalsString??"Нет графика"})},b=async()=>{let u=[];await fetch("/api/services?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async o=>{u=(await o.json()).data.recs});for(let o of u)if(o.serviceId==d.serviceId)return o.timeCost};return{data:d,showBranch:E,clientsData:i,servicesData:T,typesData:S,categories:D,branches:e,masters:g,branchChange:U,changeMaster:j,scheduls:y,intervals:B,changeSchedule:C,timeCost:I,getTimeCostService:b,changeService:async()=>{I=await b(),await C()},clickBtn:async()=>{d.client.name&&d.client.phone?d.clientId=null:d.client=null,console.log(d.clientId),await fetch("/api/applications",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then(async u=>{let o=await u.json();o.message=="OK"?(t.success("Запись успешно добавлена"),a.push({name:"dashboard.home"})):o.message=="DUPLICATION"||o.message=="DUPLICATION"?t.error("Дублирование записи"):o.message=="NOT CHANGED"?t.info("Внесите изменения"):o.message=="DATA NOT VALID"||o.status==400?t.error("Введите значения"):t.error("Ошибка при добавлении записи")})},clientSelected:w,plusMinusBtnClickHandler:k}}}),L=s("div",{class:"flex-column"},[s("h1",{class:"row h3"}," Создать запись заявки ")],-1),z={class:"row form-group mt-3"},P=s("label",{class:"h5"},"Клиент",-1),J={key:0,class:"col-8"},K=["value"],R={key:1,class:"col-8"},q={class:"row"},Q=s("label",{class:"h5"},"Введите имя",-1),W={class:"col-12"},X={class:"row"},Y=s("label",{class:"h5"},"Введите телефон",-1),Z={class:"col-12"},x={class:"col-4"},ee={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus",viewBox:"0 0 16 16"},te={key:0,d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"},se={key:1,d:"M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"},ae={class:"row form-group mt-3"},ne=s("label",{class:"h5"},"Услуга",-1),le={class:"col-12"},oe=["value"],ie={class:"row form-group mt-3"},de=s("label",{class:"h5"},"Прайс лист",-1),ue={class:"col-12"},re=["value"],ce={class:"row form-group mt-3"},he=s("label",{class:"h5"},"Категория",-1),me={class:"col-12"},pe=["value"],ve={key:0,class:"row form-group mt-3"},Ie=s("label",{class:"h5"},"Филиал",-1),fe={class:"col-12"},ge=["value"],ye={class:"row form-group mt-3"},we=s("label",{class:"h5"},"Мастер",-1),Ce={class:"col-12"},be=["value"],_e={class:"row form-group mt-3"},Te=s("label",{class:"h5"},"Дни работы",-1),Se={class:"col-12"},De=["value"],Be={class:"row form-group mt-3"},je=s("label",{class:"h5"},"Доступное время",-1),Ee={class:"col-12"},ke=["value"],Ue={class:"row form-group mt-3"},Ve=s("label",{class:"h5"},"Введите время",-1),Ae={class:"col-12"},Me=s("div",{class:"row mt-4"},[s("button",{type:"submit",class:"btn btn-success me-3",style:{width:"120px"}},"Сохранить")],-1);function Fe(t,a,i,T,S,D){return n(),l("div",null,[L,s("form",{onSubmit:a[15]||(a[15]=N((...e)=>t.clickBtn&&t.clickBtn(...e),["prevent"]))},[s("div",z,[P,t.clientSelected.val?(n(),l("div",J,[r(s("select",{class:"form-control","onUpdate:modelValue":a[0]||(a[0]=e=>t.data.clientId=e)},[(n(!0),l(p,null,v(t.clientsData,e=>(n(),l("option",{value:e.clientId},c(e.name),9,K))),256))],512),[[m,t.data.clientId]])])):(n(),l("div",R,[s("div",q,[Q,s("div",W,[r(s("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>t.data.client.name=e),class:"form-control"},null,512),[[_,t.data.client.name]])])]),s("div",X,[Y,s("div",Z,[r(s("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>t.data.client.phone=e),class:"form-control"},null,512),[[_,t.data.client.phone]])])])])),s("div",x,[s("button",{type:"button",class:"btn btn-secondary",onClick:a[3]||(a[3]=(...e)=>t.plusMinusBtnClickHandler&&t.plusMinusBtnClickHandler(...e))},[(n(),l("svg",ee,[t.clientSelected.val?(n(),l("path",te)):(n(),l("path",se))]))])])]),s("div",ae,[ne,s("div",le,[r(s("select",{class:"form-control","onUpdate:modelValue":a[4]||(a[4]=e=>t.data.serviceId=e),onChange:a[5]||(a[5]=(...e)=>t.changeService&&t.changeService(...e))},[(n(!0),l(p,null,v(t.servicesData,e=>(n(),l("option",{value:e.serviceId},c(e.name)+" - "+c(e.timeCost)+"мин.",9,oe))),256))],544),[[m,t.data.serviceId]])])]),s("div",ie,[de,s("div",ue,[r(s("select",{class:"form-control","onUpdate:modelValue":a[6]||(a[6]=e=>t.data.typeId=e)},[(n(!0),l(p,null,v(t.typesData,e=>(n(),l("option",{value:e.id},c(e.name),9,re))),256))],512),[[m,t.data.typeId]])])]),s("div",ce,[he,s("div",me,[r(s("select",{class:"form-control","onUpdate:modelValue":a[7]||(a[7]=e=>t.data.categoryId=e)},[(n(!0),l(p,null,v(t.categories,e=>(n(),l("option",{value:e.id},c(e.name),9,pe))),256))],512),[[m,t.data.categoryId]])])]),t.showBranch?(n(),l("div",ve,[Ie,s("div",fe,[r(s("select",{class:"form-control","onUpdate:modelValue":a[8]||(a[8]=e=>t.data.branchId=e),onChange:a[9]||(a[9]=(...e)=>t.branchChange&&t.branchChange(...e))},[(n(!0),l(p,null,v(t.branches,e=>(n(),l("option",{value:e.branchId},c(e.address),9,ge))),256))],544),[[m,t.data.branchId]])])])):$("",!0),s("div",ye,[we,s("div",Ce,[r(s("select",{class:"form-control","onUpdate:modelValue":a[10]||(a[10]=e=>t.data.masterId=e),onChange:a[11]||(a[11]=(...e)=>t.changeMaster&&t.changeMaster(...e))},[(n(!0),l(p,null,v(t.masters,e=>(n(),l("option",{value:e.masterId},c(e.fio),9,be))),256))],544),[[m,t.data.masterId]])])]),s("div",_e,[Te,s("div",Se,[r(s("select",{class:"form-control","onUpdate:modelValue":a[12]||(a[12]=e=>t.data.scheduleId=e),onChange:a[13]||(a[13]=(...e)=>t.changeSchedule&&t.changeSchedule(...e))},[(n(!0),l(p,null,v(t.scheduls,e=>(n(),l("option",{value:e.scheduleId},c(e.dateString),9,De))),256))],544),[[m,t.data.scheduleId]])])]),s("div",Be,[je,s("div",Ee,[s("textarea",{type:"text",value:t.intervals.intervalString,class:"form-control",disabled:""},null,8,ke)])]),s("div",Ue,[Ve,s("div",Ae,[r(s("input",{type:"text","onUpdate:modelValue":a[14]||(a[14]=e=>t.data.timeStart=e),class:"form-control"},null,512),[[_,t.data.timeStart]])])]),Me],32)])}const Le=G(H,[["render",Fe]]);export{Le as default};
