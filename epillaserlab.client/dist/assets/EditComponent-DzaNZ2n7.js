import{d as E,A as B,b as F,u as G,a as p,r as C,_ as V,o as n,c as o,e as a,w as u,y as c,F as h,j as m,v as U,m as $,t as r}from"./index-RBsaCAxW.js";const k=E({async beforeCreate(){fetch("/api/clients?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async t=>{let s=(await t.json()).data.recs;this.clientsData=s,this.data.clientId=s[0].clientId}),fetch("/api/services?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async t=>{let s=(await t.json()).data.recs;this.servicesData=s,this.data.serviceId=s[0].serviceId,this.timeCost=await this.getTimeCostService()}),fetch("/api/types?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async t=>{let s=(await t.json()).data.recs;this.typesData=s,this.data.typeId=s[0].id}),fetch("/api/categories?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async t=>{let s=(await t.json()).data.recs;this.categories=s,this.data.categoryId=s[0].id}),fetch("/api/branches?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async t=>{let s=(await t.json()).data.recs;this.branches=s,this.data.branchId=s[0].branchId,await this.branchChange()})},setup(){B();const t=F();G().currentRoute.value.params.id;const b=p([{clientId:0,name:null}]),w=p([{serviceId:0,name:null}]),T=p([{id:0,name:null}]),S=p([{id:0,name:null}]),e=p([{branchId:0,address:null}]);let I=C([{masterId:null,fio:""}]),g=C([{scheduleId:null,dateString:""}]),_=C({intervalString:""}),v=0;const i=p({clientId:null,serviceId:null,typeId:null,categoryId:null,branchId:null,masterId:null,scheduleId:null,timeStart:null}),D=async()=>{fetch(`/api/masters?limit=1000&branchId=${i.branchId??-1}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async d=>{let l=(await d.json()).data.recs;l.length>0?(I.value=l,i.masterId=l[0].masterId??null):(I.value=[],i.masterId=null),await j()})},j=async()=>{fetch(`/api/schedules?limit=1000&masterId=${i.masterId??-1}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async d=>{let l=(await d.json()).data.recs;l.length>0?(g.value=l,i.scheduleId=l[0].scheduleId??null):(g.value=[],i.scheduleId=null),v=await y(),await f()})},f=async()=>{fetch(`/api/intervals/${i.scheduleId??-1}?timeCost=${v}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async d=>{_.value.intervalString=(await d.json()).intervalsString??"Нет графика"})},y=async()=>{let d=[];await fetch("/api/services?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async l=>{d=(await l.json()).data.recs});for(let l of d)if(l.serviceId==i.serviceId)return l.timeCost};return{data:i,clientsData:b,servicesData:w,typesData:T,categories:S,branches:e,masters:I,branchChange:D,changeMaster:j,scheduls:g,intervals:_,changeSchedule:f,timeCost:v,getTimeCostService:y,changeService:async()=>{v=await y(),await f()},clickBtn:async()=>{await fetch("/api/applications",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(async d=>{console.log(i),t.success("ПППП")})}}}}),M=a("div",{class:"flex-column"},[a("h1",{class:"row h3"}," Добавить запись заявки ")],-1),A={class:"row form-group mt-3"},N=a("label",{class:"h5"},"Клиент",-1),O={class:"col-12"},R=["value"],J={class:"row form-group mt-3"},L=a("label",{class:"h5"},"Услуга",-1),q={class:"col-12"},z=["value"],H={class:"row form-group mt-3"},K=a("label",{class:"h5"},"Прайс лист",-1),P={class:"col-12"},Q=["value"],W={class:"row form-group mt-3"},X=a("label",{class:"h5"},"Категория",-1),Y={class:"col-12"},Z=["value"],x={class:"row form-group mt-3"},ee=a("label",{class:"h5"},"Филиал",-1),te={class:"col-12"},se=["value"],ae={class:"row form-group mt-3"},ne=a("label",{class:"h5"},"Мастер",-1),oe={class:"col-12"},le=["value"],ie={class:"row form-group mt-3"},de=a("label",{class:"h5"},"Дни работы",-1),ue={class:"col-12"},re=["value"],ce={class:"row form-group mt-3"},he=a("label",{class:"h5"},"Доступное время",-1),me={class:"col-12"},pe=["value"],ve={class:"row form-group mt-3"},Ie=a("label",{class:"h5"},"Введите время",-1),ge={class:"col-12"},fe=a("div",{class:"row mt-4"},[a("button",{type:"submit",class:"btn btn-success me-3",style:{width:"120px"}},"Сохранить")],-1);function ye(t,s,b,w,T,S){return n(),o("div",null,[M,a("form",{onSubmit:s[12]||(s[12]=$((...e)=>t.clickBtn&&t.clickBtn(...e),["prevent"]))},[a("div",A,[N,a("div",O,[u(a("select",{class:"form-control","onUpdate:modelValue":s[0]||(s[0]=e=>t.data.clientId=e)},[(n(!0),o(h,null,m(t.clientsData,e=>(n(),o("option",{value:e.clientId},r(e.name),9,R))),256))],512),[[c,t.data.clientId]])])]),a("div",J,[L,a("div",q,[u(a("select",{class:"form-control","onUpdate:modelValue":s[1]||(s[1]=e=>t.data.serviceId=e),onChange:s[2]||(s[2]=(...e)=>t.changeService&&t.changeService(...e))},[(n(!0),o(h,null,m(t.servicesData,e=>(n(),o("option",{value:e.serviceId},r(e.name)+" - "+r(e.timeCost)+"мин.",9,z))),256))],544),[[c,t.data.serviceId]])])]),a("div",H,[K,a("div",P,[u(a("select",{class:"form-control","onUpdate:modelValue":s[3]||(s[3]=e=>t.data.typeId=e)},[(n(!0),o(h,null,m(t.typesData,e=>(n(),o("option",{value:e.id},r(e.name),9,Q))),256))],512),[[c,t.data.typeId]])])]),a("div",W,[X,a("div",Y,[u(a("select",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=e=>t.data.categoryId=e)},[(n(!0),o(h,null,m(t.categories,e=>(n(),o("option",{value:e.id},r(e.name),9,Z))),256))],512),[[c,t.data.categoryId]])])]),a("div",x,[ee,a("div",te,[u(a("select",{class:"form-control","onUpdate:modelValue":s[5]||(s[5]=e=>t.data.branchId=e),onChange:s[6]||(s[6]=(...e)=>t.branchChange&&t.branchChange(...e))},[(n(!0),o(h,null,m(t.branches,e=>(n(),o("option",{value:e.branchId},r(e.address),9,se))),256))],544),[[c,t.data.branchId]])])]),a("div",ae,[ne,a("div",oe,[u(a("select",{class:"form-control","onUpdate:modelValue":s[7]||(s[7]=e=>t.data.masterId=e),onChange:s[8]||(s[8]=(...e)=>t.changeMaster&&t.changeMaster(...e))},[(n(!0),o(h,null,m(t.masters,e=>(n(),o("option",{value:e.masterId},r(e.fio),9,le))),256))],544),[[c,t.data.masterId]])])]),a("div",ie,[de,a("div",ue,[u(a("select",{class:"form-control","onUpdate:modelValue":s[9]||(s[9]=e=>t.data.scheduleId=e),onChange:s[10]||(s[10]=(...e)=>t.changeSchedule&&t.changeSchedule(...e))},[(n(!0),o(h,null,m(t.scheduls,e=>(n(),o("option",{value:e.scheduleId},r(e.dateString),9,re))),256))],544),[[c,t.data.scheduleId]])])]),a("div",ce,[he,a("div",me,[a("textarea",{type:"text",value:t.intervals.intervalString,class:"form-control",disabled:""},null,8,pe)])]),a("div",ve,[Ie,a("div",ge,[u(a("input",{type:"text","onUpdate:modelValue":s[11]||(s[11]=e=>t.data.timeStart=e),class:"form-control"},null,512),[[U,t.data.timeStart]])])]),fe],32)])}const Se=V(k,[["render",ye]]);export{Se as default};
