import{d as O,u as w,b as L,r as v,_ as $,g as f,o as F,k as j,p as i,h as n,y as m,t as g,e as k}from"./index-DnMKBQom.js";import{I as x,O as I,D as N}from"./style-ko_XgC6k.js";const K=O({components:{TableBody:x,TableHead:I,DataTable:N},setup(){const t=w(),d=L(),b=v([]),s=v({}),u=v({}),C=a=>a.target.parentNode.dataset.id,p=async a=>{let e=C(a);await t.push({name:"dashboard.purchased-season-tickets.edit",params:{id:e}})},h=async a=>{if(!confirm("Вы точно хотите удалить запись?"))return;let o=C(a);await fetch(`/api/purchasedseasontickets/${o}`,{method:"DELETE",credentials:"include"}).then(async l=>{const r=await l.json();r.message=="OK"?(d.success("Запись удалена"),c(void 0)):r.message=="BLOCK"?d.error("Удаление записи приведет к потере данных"):d.error("Ошибка при удалении записи")}).catch(l=>t.push({name:"dashboard"}))},c=async a=>{let e,o,l,r;l=u.value.sort,typeof a=="string"?(e=s.value.page,o=s.value.limit,l=l=="asc"?"desc":"asc",r=a.split(":")[0],console.log(r),r!==u.value.order&&(l="desc")):typeof a==typeof{}?(e=a.page-1<0?0:a.page-1,o=a.per_page,r=u.value.order):(e=s.value.page,o=s.value.limit,r=u.value.order);let S={page:e,limit:o,sort:l,order:r};var B=new URLSearchParams(S);await fetch(`/api/purchasedseasontickets?${B}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async y=>{let _=await y.json();if(_.message="OK"){let D=_.data,T=D.max;e=D.page;let E=D.recs;b.value=E,s.value={...s.value,page:e,total:T,limit:o},u.value={...u.value,sort:l,order:r}}else b.value=[],s.value={...s.value,page:0,total:0,limit:o},u.value={...u.value,sort:l}}).catch(y=>t.push({name:"dashboard"}))};return{tableData:b,pagination:s,loadData:c,sort:u,delClick:h,editClick:p}}}),V=k("TableBodyCell",{class:"d-flex justify-content-center",colspan:"5"}," Нет записей ",-1);function R(t,d,b,s,u,C){const p=f("table-head"),h=f("router-link"),c=f("table-body"),a=f("data-table");return F(),j(a,{rows:t.tableData,pagination:t.pagination,sort:t.sort,striped:"",onLoadData:t.loadData,style:{"font-size":"large !important"}},{thead:i(()=>[n(p,{sortable:"name",onSorting:t.loadData},{default:i(()=>[m("Услуга")]),_:1},8,["onSorting"]),n(p,{sortable:"client",onSorting:t.loadData},{default:i(()=>[m("Клиент")]),_:1},8,["onSorting"]),n(p,{sortable:"remains",onSorting:t.loadData},{default:i(()=>[m("Оставшиеся посещения")]),_:1},8,["onSorting"]),n(p,{sortable:"dateOfCombustion",onSorting:t.loadData},{default:i(()=>[m("Дата сгорания")]),_:1},8,["onSorting"]),n(p,null,{default:i(()=>[n(h,{to:{name:"dashboard.purchased-season-tickets.add"},tag:"button",type:"button",class:"btn btn-success"},{default:i(()=>[m("Добавить")]),_:1})]),_:1})]),tbody:i(({row:e})=>[n(c,{textContent:g(e.name)},null,8,["textContent"]),n(c,{textContent:g(e.client)},null,8,["textContent"]),n(c,{textContent:g(e.remains)},null,8,["textContent"]),n(c,{textContent:g(e.dateOfCombustionString)},null,8,["textContent"]),n(c,{"data-id":e.purchasedSeasonTicketId},{default:i(()=>[k("button",{type:"button",class:"btn btn-primary me-2",onClick:d[0]||(d[0]=(...o)=>t.editClick&&t.editClick(...o))},"ИЗМЕНИТЬ"),k("button",{type:"button",class:"btn btn-danger",onClick:d[1]||(d[1]=(...o)=>t.delClick&&t.delClick(...o))},"УДАЛИТЬ")]),_:2},1032,["data-id"])]),empty:i(()=>[V]),_:1},8,["rows","pagination","sort","onLoadData"])}const H=$(K,[["render",R]]);export{H as default};
