import{d as v,s as T,u as C,i as f,r as B,_ as w,e as d,o as g,c as F,a as e,w as c,v as p,f as l,m as i,l as N,x as b,t as E}from"./index-DjdE6vYD.js";import{D as O,I as V,O as j}from"./style-DaQOmh4s.js";const A=v({components:{DataTable:O,TableBody:V,TableHead:j},beforeCreate(){fetch(`/api/services/${this.id}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async s=>{let o=await s.json();if(o.message=="OK"){let a=o.rec;this.data.name=a.name,this.data.description=a.description,this.data.timeCost=a.timeCost,this.data.priceByType=a.priceByType,this.oldData.name=a.name,this.oldData.description=a.description,this.oldData.timeCost=a.timeCost,this.oldData.priceByType=a.priceByType;for(let n of this.data.priceByType)this.priceData[n.key]=n.value;console.log(this.priceData)}})},setup(){const s=T(),o=s.currentRoute.value.params.id,a=C(),n=f({name:"",description:"",timeCost:0,priceByType:[]}),_=f({name:"",description:"",timeCost:0,priceByType:[]}),D=f({}),r=B([]);return{data:n,submitForm:async y=>{n.priceByType=[],document.querySelectorAll("input#service_price_val").forEach(t=>{let u=t;u.value&&n.priceByType.push({key:Number(u.dataset.typeId),value:Number(u.value)})}),await fetch(`/api/services/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)}).then(async t=>{const u=await t.json();u.message=="OK"?(a.success("Запись успешно изменена"),s.push({name:"dashboard.services"})):u.message=="DUPLICATION"?a.error("Дублирование записи"):u.message=="NOT CHANGED"?a.info("Внесите изменения"):u.message=="DATA NOT VALID"||u.status==400?a.error("Введите значения"):a.error("Ошибка при изменении записи")}).catch(t=>s.push({name:"dashboard"}))},tableData:r,loadData:async y=>{await fetch("/api/types",{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async t=>{let u=await t.json();u.message=="OK"?r.value=u.data.recs:a.error("Ошибка")}).catch(t=>s.push({name:"dashboard"}))},id:o,priceData:D,oldData:_}}}),U=e("div",{class:"flex-column"},[e("h1",{class:"row h3"}," Редактирование услуги ")],-1),k={class:"col-3"},I={class:"row form-group mt-3"},$=e("label",{class:"h5"},"Название",-1),x={class:"col-12"},L={class:"row form-group mt-3"},S=e("label",{class:"h5"},"Описание",-1),J={class:"col-12"},K={class:"row form-group mt-3"},q=e("label",{class:"h5"},"Время выполнения",-1),H={class:"col-12"},M={class:"row mt-4"},P=e("button",{type:"submit",class:"btn btn-success me-3",style:{width:"120px"}},"Сохранить",-1),R={class:"col-9"},z=["data-type-id","onUpdate:modelValue"],G=e("TableBodyCell",{class:"d-flex justify-content-center",colspan:"2"}," Нет записей ",-1);function Q(s,o,a,n,_,D){const r=d("router-link"),m=d("table-head"),h=d("table-body"),y=d("data-table");return g(),F("div",null,[U,e("form",{onSubmit:o[3]||(o[3]=N((...t)=>s.submitForm&&s.submitForm(...t),["prevent"])),class:"row mt-3"},[e("div",k,[e("div",I,[$,e("div",x,[c(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=t=>s.data.name=t),class:"form-control",placeholder:"Введите название"},null,512),[[p,s.data.name]])])]),e("div",L,[S,e("div",J,[c(e("textarea",{type:"text","onUpdate:modelValue":o[1]||(o[1]=t=>s.data.description=t),class:"form-control",placeholder:"Введите описание"},null,512),[[p,s.data.description]])])]),e("div",K,[q,e("div",H,[c(e("input",{type:"number","onUpdate:modelValue":o[2]||(o[2]=t=>s.data.timeCost=t),class:"form-control",placeholder:"Введите врем"},null,512),[[p,s.data.timeCost]])])]),e("div",M,[P,l(r,{tag:"button",to:{name:"dashboard.services"},type:"submit",class:"btn btn-secondary",style:{width:"120px"}},{default:i(()=>[b("Назад")]),_:1})])]),e("div",R,[l(y,{rows:s.tableData,striped:"",id:"pricesTable",onLoadData:s.loadData,style:{"font-size":"large !important"}},{thead:i(()=>[l(m,null,{default:i(()=>[b("Вид прайслиста")]),_:1}),l(m,null,{default:i(()=>[b("Цена")]),_:1})]),tbody:i(({row:t})=>[l(h,{textContent:E(t.name)},null,8,["textContent"]),l(h,null,{default:i(()=>[c(e("input",{class:"form-control",id:"service_price_val","data-type-id":t.id,"onUpdate:modelValue":u=>s.priceData[t.id]=u,type:"number"},null,8,z),[[p,s.priceData[t.id]]])]),_:2},1024)]),empty:i(()=>[G]),_:1},8,["rows","onLoadData"])])],32)])}const Y=w(A,[["render",Q]]);export{Y as default};
