import{d as B,u as x,b as L,r as D,_ as $,g as f,o as O,c as j,h as o,p as r,x as m,t as g,e as k}from"./index-B-uJWQuM.js";import{I,O as N,D as P}from"./style-BjjbMf5W.js";const F=B({components:{TableBody:I,TableHead:N,DataTable:P},setup(){const e=x(),p=L(),b=D([]),s=D({}),n=D({}),v=a=>a.target.parentNode.dataset.id,c=async a=>{let t=v(a);await e.push({name:"dashboard.seasontickets.edit",params:{id:t}})},h=async a=>{if(!confirm("Вы точно хотите удалить запись?"))return;let u=v(a);await fetch(`/api/seasontickets/${u}`,{method:"DELETE",credentials:"include"}).then(async l=>{const i=await l.json();i.message=="OK"?(p.success("Запись удалена"),d(void 0)):i.message=="BLOCK"?p.error("Удаление записи приведет к потере данных"):p.error("Ошибка при удалении записи")}).catch(l=>e.push({name:"dashboard"}))},d=async a=>{let t,u,l,i;l=n.value.sort,typeof a=="string"?(t=s.value.page,u=s.value.limit,l=l=="asc"?"desc":"asc",i=a.split(":")[0],i!==n.value.order&&(l="desc")):typeof a==typeof{}?(t=a.page-1<0?0:a.page-1,u=a.per_page,i=n.value.order):(t=s.value.page,u=s.value.limit,i=n.value.order);let S={page:t,limit:u,sort:l,order:i};var E=new URLSearchParams(S);await fetch(`/api/seasontickets?${E}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async y=>{let _=await y.json();if(_.message="OK"){let C=_.data,T=C.max;t=C.page;let w=C.recs;b.value=w,s.value={...s.value,page:t,total:T,limit:u},n.value={...n.value,sort:l,order:i}}else b.value=[],s.value={...s.value,page:0,total:0,limit:u},n.value={...n.value,sort:l,order:i}}).catch(y=>e.push({name:"dashboard"}))};return{tableData:b,pagination:s,loadData:d,sort:n,delClick:h,editClick:c}}}),K=F,V=k("TableBodyCell",{class:"d-flex justify-content-center",colspan:"2"}," Нет записей ",-1);function A(e,p,b,s,n,v){const c=f("table-head"),h=f("router-link"),d=f("table-body"),a=f("data-table");return O(),j("div",null,[o(a,{rows:e.tableData,pagination:e.pagination,sort:e.sort,striped:"",onLoadData:e.loadData,style:{"font-size":"large !important"}},{thead:r(()=>[o(c,{sortable:"service",onSorting:e.loadData},{default:r(()=>[m("Услуга")]),_:1},8,["onSorting"]),o(c,{sortable:"sessions",onSorting:e.loadData},{default:r(()=>[m("Количество посещений")]),_:1},8,["onSorting"]),o(c,{sortable:"validityPeriod",onSorting:e.loadData},{default:r(()=>[m("Срок действия")]),_:1},8,["onSorting"]),o(c,{sortable:"price",onSorting:e.loadData},{default:r(()=>[m("Цена")]),_:1},8,["onSorting"]),o(c,{style:{width:"15%"}},{default:r(()=>[o(h,{to:{name:"dashboard.seasontickets.add"},tag:"button",type:"button",class:"btn btn-success"},{default:r(()=>[m("Добавить")]),_:1})]),_:1})]),tbody:r(({row:t})=>[o(d,{textContent:g(t.service.name)},null,8,["textContent"]),o(d,{textContent:g(t.sessions)},null,8,["textContent"]),o(d,{textContent:g(t.validityPeriod)},null,8,["textContent"]),o(d,{textContent:g(t.price)},null,8,["textContent"]),o(d,{"data-id":t.seasonTicketId,style:{width:"15%"}},{default:r(()=>[k("button",{type:"button",class:"btn btn-primary me-2",onClick:p[0]||(p[0]=(...u)=>e.editClick&&e.editClick(...u))},"ИЗМЕНИТЬ")]),_:2},1032,["data-id"])]),empty:r(()=>[V]),_:1},8,["rows","pagination","sort","onLoadData"])])}const H=$(K,[["render",A]]);export{H as default};
