import{d as y,b as w,u as I,a as d,_ as D,g as C,o,c as a,e as s,w as r,z as b,F as f,j as _,v as k,h as g,p as P,m as A,t as T,y as B}from"./index-DEormJ4l.js";const E=y({mounted(){fetch("/api/clients?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async e=>{let t=(await e.json()).data.recs;this.clientsData=t,this.data.clientId=t[0].clientId}),fetch("/api/prices/subsciptions-list",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async e=>{let t=(await e.json()).recs;this.seasonTickets=t,this.data.seasonTicketPriceId=t[0].seasonTicketPriceId})},setup(){const e=w(),t=I(),p=d([{clientId:0,name:null}]),u=d({val:!0}),m=()=>u.val=!u.val,i=d({clientId:null,client:{name:null,phone:null},seasonTicketPriceId:null}),h=d([{seasonTicketPriceId:0,name:""}]);return{clientSelected:u,plusMinusBtnClickHandler:m,clientsData:p,data:i,seasonTickets:h,submitForm:async ee=>{let c={client:{name:i.client.name,phone:i.client.phone},clientId:i.clientId,seasonTicketPriceId:i.seasonTicketPriceId};(!c.client.name||!c.client.phone)&&(c.client=null),await fetch("/api/purchasedseasontickets",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)}).then(async v=>{const l=await v.json();l.message=="OK"?(e.success("Запись успешно добавлена"),t.push({name:"dashboard.purchased-season-tickets"})):l.message=="DUPLICATION"||l.message=="DUPLICATION"?e.error("Дублирование записи"):l.message=="NOT CHANGED"?e.info("Внесите изменения"):l.message=="DATA NOT VALID"||l.status==400?e.error("Введите значения"):e.error("Ошибка при добавлении записи")}).catch(v=>t.push({name:"dashboard"}))}}}}),N=s("div",{class:"flex-column"},[s("h1",{class:"row h3"}," Добавить купленный абонимент ")],-1),F={class:"row form-group mt-3"},M=s("label",{class:"h5"},"Клиент",-1),S={key:0,class:"col-8"},V=["value"],j={key:1,class:"col-8"},O={class:"row"},U=s("label",{class:"h5"},"Введите имя",-1),H={class:"col-12"},L={class:"row"},$=s("label",{class:"h5"},"Введите телефон",-1),G={class:"col-12"},z={class:"col-4"},J={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus",viewBox:"0 0 16 16"},K={key:0,d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"},R={key:1,d:"M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"},q={class:"row form-group mt-3"},Q=s("label",{class:"h5"},"Абонемент",-1),W={class:"col-8"},X=["value"],Y={class:"row mt-4"},Z=s("button",{type:"submit",class:"btn btn-success me-3",style:{width:"120px"}},"Сохранить",-1);function x(e,t,p,u,m,i){const h=C("router-link");return o(),a("div",null,[N,s("form",{onSubmit:t[5]||(t[5]=A((...n)=>e.submitForm&&e.submitForm(...n),["prevent"])),class:"row mt-3"},[s("div",F,[M,e.clientSelected.val?(o(),a("div",S,[r(s("select",{class:"form-control","onUpdate:modelValue":t[0]||(t[0]=n=>e.data.clientId=n)},[(o(!0),a(f,null,_(e.clientsData,n=>(o(),a("option",{value:n.clientId},T(n.name),9,V))),256))],512),[[b,e.data.clientId]])])):(o(),a("div",j,[s("div",O,[U,s("div",H,[r(s("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>e.data.client.name=n),class:"form-control"},null,512),[[k,e.data.client.name]])])]),s("div",L,[$,s("div",G,[r(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>e.data.client.phone=n),class:"form-control"},null,512),[[k,e.data.client.phone]])])])])),s("div",z,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[3]||(t[3]=(...n)=>e.plusMinusBtnClickHandler&&e.plusMinusBtnClickHandler(...n))},[(o(),a("svg",J,[e.clientSelected.val?(o(),a("path",K)):(o(),a("path",R))]))])])]),s("div",q,[Q,s("div",W,[r(s("select",{class:"form-control","onUpdate:modelValue":t[4]||(t[4]=n=>e.data.seasonTicketPriceId=n)},[(o(!0),a(f,null,_(e.seasonTickets,n=>(o(),a("option",{value:n.seasonTicketPriceId},T(n.name),9,X))),256))],512),[[b,e.data.seasonTicketPriceId]])])]),s("div",Y,[Z,g(h,{tag:"button",to:{name:"dashboard.purchased-season-tickets"},type:"submit",class:"btn btn-secondary",style:{width:"120px"}},{default:P(()=>[B("Назад")]),_:1})])],32)])}const te=D(E,[["render",x]]);export{te as default};
