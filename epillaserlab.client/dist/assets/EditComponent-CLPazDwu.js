import{d as v,u as w,r as y,b as C,a as g,_ as I,g as k,o as c,c as m,e,w as l,z as D,F as T,j as B,f as U,v as h,A as E,h as O,p as A,m as F,t as N,y as V}from"./index-DEormJ4l.js";import{D as j,I as $,O as S}from"./style-Baea8FYp.js";import{U as L}from"./UserStore-BqrtbZif.js";const W=v({components:{DataTable:j,TableBody:$,TableHead:S},async beforeCreate(){var s=await L.user();s.roleId==2?(this.data.branchId=s.admin.branchId,this.showBranch=!1):await fetch("/api/branches?page=0&limit=999&order=name&sort=asc",{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async t=>{let r=await t.json();r.message=="OK"&&(this.branches=r.data.recs,this.data.branchId=this.branches[0].branchId,this.$forceUpdate())}),await fetch(`/api/masters/${this.id}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async t=>{let r=await t.json();if(r.message=="OK"){let o=r.rec;this.data.branchId=o.branchId,this.data.employee.surname=o.employee.surname,this.data.employee.name=o.employee.name,this.data.employee.patronymic=o.employee.patronymic,this.data.employee.isWork=o.employee.isWork,this.imageSrc=`/resources/images/${o.photoPath}`}}),this.$forceUpdate()},setup(){const s=w(),t=s.currentRoute.value.params.id,r=y(!0),o=C();let f=y("https://imgholder.ru/300X300/8493a8/adb9ca&font=kelson");const b=g([{branchId:0,address:""}]),n=g({branchId:0,employee:{surname:null,name:null,patronymic:null,isWork:!0},photo:null});return{data:n,submitForm:async p=>{await fetch(`/api/masters/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)}).then(async i=>{const u=await i.json();u.message=="OK"?(o.success("Запись успешно изменена"),s.push({name:"dashboard.masters"})):u.message=="DUPLICATION"||u.message=="DUPLICATION"?o.error("Дублирование записи"):u.message=="NOT CHANGED"?o.info("Внесите изменения"):u.message=="DATA NOT VALID"||u.status==400?o.error("Введите значения"):o.error("Ошибка при изменении записи")}).catch(i=>s.push({name:"dashboard"}))},getBase64:p=>{let i=p.files[0];var u=new FileReader;u.readAsDataURL(i),u.onload=function(){let d=u.result.split(";"),_=d[0];["data:image/jpeg","data:image/png","data:image/jpg"].indexOf(_)!=-1?(n.photo=d[1].replace("base64,",""),document.getElementById("image").src=u.result):(p.value=null,o.error("Недопустимый тип файла"))},u.onerror=function(d){console.log("Error: ",d)}},branches:b,imageSrc:f,id:t,showBranch:r}}}),x=e("div",{class:"flex-column"},[e("h1",{class:"row h3"}," Изменить запись сотрудника ")],-1),M={class:"col-3"},P={class:"row form-group mt-3"},R=["src"],J=e("label",{class:"h5"},"Изображение",-1),K={class:"input-group mb-3"},H=e("label",{class:"input-group-text"},"Загрузка",-1),z={key:0,class:"row form-group mt-3"},G=e("label",{class:"h5"},"Филиал",-1),X={class:"col-12"},q=["value"],Q={class:"row form-group mt-3"},Y=e("label",{class:"h5"},"Фамилия",-1),Z={class:"col-12"},ee={class:"row form-group mt-3"},se=e("label",{class:"h5"},"Имя",-1),te={class:"col-12"},ae={class:"row form-group mt-3"},oe=e("label",{class:"h5"},"Отчество",-1),ue={class:"col-12"},re={class:"form-check mt-3"},ne=e("label",{class:"form-check-label h5",for:"flexCheckDefault"}," Работает ",-1),le={class:"row mt-4"},ie=e("button",{type:"submit",class:"btn btn-success me-3",style:{width:"120px"}},"Сохранить",-1);function de(s,t,r,o,f,b){const n=k("router-link");return c(),m("div",null,[x,e("form",{onSubmit:t[6]||(t[6]=F((...a)=>s.submitForm&&s.submitForm(...a),["prevent"])),class:"row mt-3"},[e("div",M,[e("div",P,[e("img",{width:"300px",height:"300px",src:s.imageSrc,id:"image"},null,8,R),J,e("div",K,[e("input",{type:"file",class:"form-control",onChange:t[0]||(t[0]=a=>{a.target.files.length>0&&s.getBase64(a.target)})},null,32),H])]),s.showBranch?(c(),m("div",z,[G,e("div",X,[l(e("select",{class:"form-control","onUpdate:modelValue":t[1]||(t[1]=a=>s.data.branchId=a)},[(c(!0),m(T,null,B(s.branches,a=>(c(),m("option",{value:a.branchId},N(a.address),9,q))),256))],512),[[D,s.data.branchId]])])])):U("",!0),e("div",Q,[Y,e("div",Z,[l(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>s.data.employee.surname=a),class:"form-control",placeholder:"Введите адрес"},null,512),[[h,s.data.employee.surname]])])]),e("div",ee,[se,e("div",te,[l(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=a=>s.data.employee.name=a),class:"form-control",placeholder:"Введите адрес"},null,512),[[h,s.data.employee.name]])])]),e("div",ae,[oe,e("div",ue,[l(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=a=>s.data.employee.patronymic=a),class:"form-control",placeholder:"Введите адрес"},null,512),[[h,s.data.employee.patronymic]])])]),e("div",re,[ne,l(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=a=>s.data.employee.isWork=a),id:"flexCheckDefault"},null,512),[[E,s.data.employee.isWork]])]),e("div",le,[ie,O(n,{tag:"button",to:{name:"dashboard.masters"},type:"submit",class:"btn btn-secondary",style:{width:"120px"}},{default:A(()=>[V("Назад")]),_:1})])])],32)])}const fe=I(W,[["render",de]]);export{fe as default};
