import{d as T,u as w,s as I,i as d,_ as C,e as D,o as a,c as o,a as t,w as r,y as f,F as _,h as b,v as k,f as g,m as P,l as B,t as y,x as A}from"./index-BSdrrqya.js";const E=T({async mounted(){await fetch("/api/clients?limit=1000",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async e=>{let s=(await e.json()).data.recs;this.clientsData=s}),await fetch("/api/prices/subsciptions-list",{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async e=>{let s=(await e.json()).recs;this.seasonTickets=s}),fetch(`/api/purchasedseasontickets/${this.id}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}).then(async e=>{let s=(await e.json()).rec;this.data.clientId=s.clientId,this.data.seasonTicketPriceId=s.seasonTicketPriceId})},setup(){const e=w(),s=I(),h=s.currentRoute.value.params.id,p=d([{clientId:0,name:null}]),u=d({val:!0}),m=()=>u.val=!u.val,i=d({clientId:null,client:{name:null,phone:null},seasonTicketPriceId:null}),n=d([{seasonTicketPriceId:0,name:""}]);return{clientSelected:u,plusMinusBtnClickHandler:m,clientsData:p,data:i,seasonTickets:n,submitForm:async se=>{let c={client:{name:i.client.name,phone:i.client.phone},clientId:i.clientId,seasonTicketPriceId:i.seasonTicketPriceId};(!c.client.name||!c.client.phone)&&(c.client=null),await fetch(`/api/purchasedseasontickets/${h}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)}).then(async v=>{const l=await v.json();l.message=="OK"?(e.success("Запись успешно изменина"),s.push({name:"dashboard.purchased-season-tickets"})):l.message=="DUPLICATION"||l.message=="DUPLICATION"?e.error("Дублирование записи"):l.message=="NOT CHANGED"?e.info("Внесите изменения"):l.message=="DATA NOT VALID"||l.status==400?e.error("Введите значения"):e.error("Ошибка при добавлении записи")}).catch(v=>s.push({name:"dashboard"}))},id:h}}}),N=t("div",{class:"flex-column"},[t("h1",{class:"row h3"}," Изменить купленный абонимент ")],-1),j={class:"row form-group mt-3"},F=t("label",{class:"h5"},"Клиент",-1),M={key:0,class:"col-8"},V=["value"],S={key:1,class:"col-8"},U={class:"row"},O=t("label",{class:"h5"},"Введите имя",-1),$={class:"col-12"},G={class:"row"},H=t("label",{class:"h5"},"Введите телефон",-1),L={class:"col-12"},R={class:"col-4"},z={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus",viewBox:"0 0 16 16"},J={key:0,d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"},K={key:1,d:"M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"},q={class:"row form-group mt-3"},Q=t("label",{class:"h5"},"Абонемент",-1),W={class:"col-8"},X=["value"],Y={class:"row mt-4"},Z=t("button",{type:"submit",class:"btn btn-success me-3",style:{width:"120px"}},"Сохранить",-1);function x(e,s,h,p,u,m){const i=D("router-link");return a(),o("div",null,[N,t("form",{onSubmit:s[5]||(s[5]=B((...n)=>e.submitForm&&e.submitForm(...n),["prevent"])),class:"row mt-3"},[t("div",j,[F,e.clientSelected.val?(a(),o("div",M,[r(t("select",{class:"form-control","onUpdate:modelValue":s[0]||(s[0]=n=>e.data.clientId=n)},[(a(!0),o(_,null,b(e.clientsData,n=>(a(),o("option",{value:n.clientId},y(n.name),9,V))),256))],512),[[f,e.data.clientId]])])):(a(),o("div",S,[t("div",U,[O,t("div",$,[r(t("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=n=>e.data.client.name=n),class:"form-control"},null,512),[[k,e.data.client.name]])])]),t("div",G,[H,t("div",L,[r(t("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=n=>e.data.client.phone=n),class:"form-control"},null,512),[[k,e.data.client.phone]])])])])),t("div",R,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[3]||(s[3]=(...n)=>e.plusMinusBtnClickHandler&&e.plusMinusBtnClickHandler(...n))},[(a(),o("svg",z,[e.clientSelected.val?(a(),o("path",J)):(a(),o("path",K))]))])])]),t("div",q,[Q,t("div",W,[r(t("select",{class:"form-control","onUpdate:modelValue":s[4]||(s[4]=n=>e.data.seasonTicketPriceId=n)},[(a(!0),o(_,null,b(e.seasonTickets,n=>(a(),o("option",{value:n.seasonTicketPriceId},y(n.name),9,X))),256))],512),[[f,e.data.seasonTicketPriceId]])])]),t("div",Y,[Z,g(i,{tag:"button",to:{name:"dashboard.purchased-season-tickets"},type:"submit",class:"btn btn-secondary",style:{width:"120px"}},{default:P(()=>[A("Назад")]),_:1})])],32)])}const ne=C(E,[["render",x]]);export{ne as default};
