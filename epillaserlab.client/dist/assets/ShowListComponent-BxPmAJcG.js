import{d as N,u as E,b as O,r as g,_ as S,g as v,o as j,c as I,h as d,p as c,x as w,t as K,e as D}from"./index-BabCA39_.js";import{I as R,O as V,D as P}from"./style-CAl2ip43.js";const x=N({components:{TableBody:R,TableHead:V,DataTable:P},setup(){const a=E(),o=a.currentRoute.value.params.referencename,m=O(),f=g([]),t=g({}),i=g({}),n=g({}),b=e=>e.target.parentNode.dataset.id,h=async e=>{let l=b(e);await a.push({name:"dashboard.reference.edit",params:{referencename:o,id:l}})},C=async e=>{if(!confirm("Вы точно хотите удалить запись?"))return;let u=b(e);await fetch(`/api/${o}/${u}`,{method:"DELETE",credentials:"include"}).then(async s=>{const r=await s.json();r.message=="OK"?(m.success("Запись удалена"),p(void 0)):r.message=="BLOCK"?m.error("Удаление записи приведет к потере данных"):m.error("Ошибка при удалении записи")}).catch(s=>a.push({name:"dashboard"}))},p=async e=>{let l,u,s,r;s=n.value.sort,typeof e=="string"?(l=t.value.page,u=t.value.limit,r=i.value.search,s=="asc"?s="desc":s="asc"):typeof e==typeof{}?(l=e.page-1<0?0:e.page-1,u=e.per_page,r=e.search):(l=t.value.page,u=t.value.limit,r=i.value.search);let T={page:l,limit:u,sort:s,search:r};var $=new URLSearchParams(T);await fetch(`/api/${o}?${$}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async _=>{let k=await _.json();if(k.message="OK"){let y=k.data,B=y.max;l=y.page;let L=y.recs;f.value=L,t.value={...t.value,page:l,total:B,limit:u},n.value={...n.value,sort:s},i.value={...i.value,search:r}}else f.value=[],t.value={...t.value,page:0,total:0,limit:u},n.value={...n.value,sort:s},i.value={...i.value,search:r}}).catch(_=>a.push({name:"dashboard"}))};return{tableData:f,pagination:t,loadData:p,sort:n,delClick:C,refName:o,editClick:h}}}),z=x,F={class:"row col-8"},H=D("TableBodyCell",{class:"d-flex justify-content-center",colspan:"2"}," Нет записей ",-1);function J(a,o,m,f,t,i){const n=v("table-head"),b=v("router-link"),h=v("table-body"),C=v("data-table");return j(),I("div",F,[d(C,{rows:a.tableData,pagination:a.pagination,sort:a.sort,filter:"",striped:"",onLoadData:a.loadData,style:{"font-size":"large !important"}},{thead:c(()=>[d(n,{sortable:"name",onSorting:a.loadData,style:{width:"70%"}},{default:c(()=>[w("Название")]),_:1},8,["onSorting"]),d(n,null,{default:c(()=>[d(b,{to:{name:"dashboard.reference.add",params:{referencename:a.refName}},tag:"button",type:"button",class:"btn btn-success"},{default:c(()=>[w("Добавить")]),_:1},8,["to"])]),_:1})]),tbody:c(({row:p})=>[d(h,{textContent:K(p.name),style:{width:"70%"}},null,8,["textContent"]),d(h,{"data-id":p.id},{default:c(()=>[D("button",{type:"button",class:"btn btn-primary me-2",onClick:o[0]||(o[0]=(...e)=>a.editClick&&a.editClick(...e))},"ИЗМЕНИТЬ"),D("button",{type:"button",class:"btn btn-danger",onClick:o[1]||(o[1]=(...e)=>a.delClick&&a.delClick(...e))},"УДАЛИТЬ")]),_:2},1032,["data-id"])]),empty:c(()=>[H]),_:1},8,["rows","pagination","sort","onLoadData"])])}const G=S(z,[["render",J]]);export{G as default};
