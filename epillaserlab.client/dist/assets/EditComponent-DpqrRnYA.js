import{d as b,u as y,b as w,a as d,_ as g,g as I,o as c,c as m,e,w as p,v as f,z as D,F as T,j as _,m as C,h as O,p as N,t as S,y as j}from"./index-DnMKBQom.js";import{D as A,I as $,O as F}from"./style-ko_XgC6k.js";import{U}from"./UserStore-DUfprOyA.js";const E=b({components:{DataTable:A,TableBody:$,TableHead:F},async beforeCreate(){var s=await U.user(),t=null;s.roleId==2&&(t=s.admin.branchId),await fetch(`/api/masters?limit=9999&branchId=${t}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async a=>{let n=await a.json();n.message=="OK"&&(this.masters=n.data.recs)}),await fetch(`/api/schedules/${this.id}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async a=>{let n=await a.json();n.message=="OK"&&(this.data.date=n.rec.date.replace("T00:00:00",""),this.data.masterId=n.rec.masterId)}),await fetch(`/api/intervals/${this.id}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async a=>{let n=await a.json();n.message=="OK"&&(this.intervals.intervalString=n.intervalsString)}),this.$forceUpdate()},setup(){const s=y(),t=s.currentRoute.value.params.id,a=w(),n=d([{masterId:0,fio:""}]),i=d({intervalString:""}),l=d({date:new Date().toJSON().slice(0,10),masterId:null});return{data:l,submitForm:async v=>{await fetch(`/api/schedules/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(l)}).then(async r=>{const u=await r.json();u.message=="OK"?(a.success("Запись успешно изменена"),s.push({name:"dashboard.schedules"})):u.message=="DUPLICATION"?a.error("Дублирование записи"):u.message=="NOT CHANGED"?a.info("Внесите изменения"):u.message=="DATA NOT VALID"||u.status==400?a.error("Введите значения"):a.error("Ошибка при добавлении записи")}).catch(r=>s.push({name:"dashboard"}))},masters:n,intervals:i,id:t,setIntervals:async v=>{await fetch(`/api/intervals/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:`"${i.intervalString}"`}).then(async r=>{const u=await r.json();u.message=="OK"?a.success("Запись успешно изменена"):u.message=="DUPLICATION"?a.error("Дублирование записи"):u.message=="NOT CHANGED"?a.info("Внесите изменения"):u.message=="DATA NOT VALID"||u.status==400?a.error("Введите значения"):a.error("Ошибка при добавлении записи")}).catch(r=>console.log(r))}}}}),V=e("div",{class:"flex-column"},[e("h1",{class:"row h3"}," Редактировать запись расписания ")],-1),B={class:"col-3"},J={class:"row form-group mt-3"},k=e("label",{class:"h5"},"Дата",-1),K={class:"col-12"},L=["min"],P={class:"row form-group mt-3"},H=e("label",{class:"h5"},"Мастер",-1),M={class:"col-12"},G=["value"],R=e("div",{class:"row mt-4"},[e("button",{type:"submit",class:"btn btn-success me-3",style:{width:"120px"}},"Сохранить")],-1),x={class:"row form-group mt-5 col-6"},z=e("label",{class:"h5"},"Рабочие интервалы",-1),q={class:"col-12"},Q={class:"row mt-4"};function W(s,t,a,n,i,l){const h=I("router-link");return c(),m("div",null,[V,e("form",{onSubmit:t[2]||(t[2]=C((...o)=>s.submitForm&&s.submitForm(...o),["prevent"])),class:"row mt-3"},[e("div",B,[e("div",J,[k,e("div",K,[p(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=o=>s.data.date=o),class:"form-control",placeholder:"Введите название",min:new Date().toJSON().slice(0,10)},null,8,L),[[f,s.data.date]])])]),e("div",P,[H,e("div",M,[p(e("select",{class:"form-control","onUpdate:modelValue":t[1]||(t[1]=o=>s.data.masterId=o)},[(c(!0),m(T,null,_(s.masters,o=>(c(),m("option",{value:o.masterId},S(o.fio),9,G))),256))],512),[[D,s.data.masterId]])])]),R])],32),e("div",x,[z,e("div",q,[p(e("textarea",{type:"text","onUpdate:modelValue":t[3]||(t[3]=o=>s.intervals.intervalString=o),class:"form-control",placeholder:"Введите интервал"},null,512),[[f,s.intervals.intervalString]])]),e("div",Q,[e("button",{type:"button",class:"btn btn-primary me-3",style:{width:"120px"},onClick:t[4]||(t[4]=(...o)=>s.setIntervals&&s.setIntervals(...o))},"Установить"),O(h,{tag:"button",to:{name:"dashboard.schedules"},type:"submit",class:"btn btn-secondary",style:{width:"120px"}},{default:N(()=>[j("Назад")]),_:1})])])])}const ee=g(E,[["render",W]]);export{ee as default};
