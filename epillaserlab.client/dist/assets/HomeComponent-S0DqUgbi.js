import{d as x,u as I,b as F,r as C,_ as $,g as b,o as w,c as N,e as g,h as a,p as s,F as j,y as p,t as m}from"./index-DEormJ4l.js";import{I as E,O as L,D as O}from"./style-Baea8FYp.js";import{U}from"./UserStore-BqrtbZif.js";const V=x({components:{TableBody:E,TableHead:L,DataTable:O},setup(){const e=I();F();const c=C([]),u=C({}),l=C({}),h=n=>n.target.parentNode.dataset.id;return{tableData:c,pagination:u,loadData:async n=>{let t,d,o,r;o=l.value.sort,typeof n=="string"?(t=u.value.page,d=u.value.limit,o=o=="asc"?"desc":"asc",r=n.split(":")[0],r!==l.value.order&&(o="desc")):typeof n==typeof{}?(t=n.page-1<0?0:n.page-1,d=n.per_page,r=l.value.order):(t=u.value.page,d=u.value.limit,r=l.value.order);let v={page:t,limit:d,sort:o,order:r,branchId:null};var _=await U.user();_.roleId==2&&(v.branchId=_.admin.branchId);var B=new URLSearchParams(v);await fetch(`/api/applications?${B}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async D=>{let y=await D.json();if(y.message="OK"){let f=y.data,k=f.max;t=f.page;let T=f.recs;c.value=T,u.value={...u.value,page:t,total:k,limit:d},l.value={...l.value,sort:o,order:r}}else c.value=[],u.value={...u.value,page:0,total:0,limit:d},l.value={...l.value,sort:o,order:r}}).catch(D=>e.push({name:"dashboard"}))},sort:l,editClick:async n=>{let t=h(n);await e.push({name:"dashboard.applications.edit",params:{id:t}})}}}}),A=g("h1",{class:"h2"}," Главная ",-1),H=g("TableBodyCell",{class:"d-flex justify-content-center",colspan:"2"}," Нет записей ",-1);function R(e,c,u,l,h,S){const i=b("table-head"),n=b("router-link"),t=b("table-body"),d=b("data-table");return w(),N(j,null,[A,g("div",null,[a(d,{rows:e.tableData,pagination:e.pagination,sort:e.sort,striped:"",onLoadData:e.loadData,style:{"font-size":"large !important"}},{thead:s(()=>[a(i,{sortable:"branch",onSorting:e.loadData},{default:s(()=>[p("Филлиал")]),_:1},8,["onSorting"]),a(i,{sortable:"master",onSorting:e.loadData},{default:s(()=>[p("Мастер")]),_:1},8,["onSorting"]),a(i,{sortable:"client",onSorting:e.loadData},{default:s(()=>[p("Клиент")]),_:1},8,["onSorting"]),a(i,{sortable:"dateTime",onSorting:e.loadData},{default:s(()=>[p("Дата и время")]),_:1},8,["onSorting"]),a(i,{sortable:"service",onSorting:e.loadData},{default:s(()=>[p("Услуга")]),_:1},8,["onSorting"]),a(i,{sortable:"price",onSorting:e.loadData},{default:s(()=>[p("Цена")]),_:1},8,["onSorting"]),a(i,{style:{width:"7%"}},{default:s(()=>[a(n,{to:{name:"dashboard.applications.add"},tag:"button",type:"button",class:"btn btn-success"},{default:s(()=>[p("Добавить")]),_:1})]),_:1})]),tbody:s(({row:o})=>[a(t,{textContent:m(o.branch)},null,8,["textContent"]),a(t,{textContent:m(o.master)},null,8,["textContent"]),a(t,{textContent:m(o.client)},null,8,["textContent"]),a(t,{textContent:m(o.dateTime)},null,8,["textContent"]),a(t,{textContent:m(o.service)},null,8,["textContent"]),a(t,{textContent:m(o.price)},null,8,["textContent"]),a(t,{"data-id":o.applicationId,style:{width:"7%"}},{default:s(()=>[g("button",{type:"button",class:"btn btn-primary me-2",onClick:c[0]||(c[0]=(...r)=>e.editClick&&e.editClick(...r))},"Открыть")]),_:2},1032,["data-id"])]),empty:s(()=>[H]),_:1},8,["rows","pagination","sort","onLoadData"])])],64)}const P=$(V,[["render",R]]);export{P as default};
