import{d as y,u as _,b as v,a as f,r as w,_ as C,g as I,o as d,c,e,w as r,z as D,F as k,j as B,f as T,v as m,A,h as E,p as O,m as U,t as F,y as N}from"./index-DEormJ4l.js";import{D as V,I as j,O as S}from"./style-Baea8FYp.js";import{U as x}from"./UserStore-BqrtbZif.js";const L=y({components:{DataTable:V,TableBody:j,TableHead:S},async beforeCreate(){var t=await x.user();t.roleId==2?(this.data.branchId=t.admin.branchId,this.showBranch=!1):fetch("/api/branches?page=0&limit=999&order=name&sort=asc",{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async s=>{let u=await s.json();u.message=="OK"&&(this.branches=u.data.recs,this.data.branchId=this.branches[0].branchId,this.$forceUpdate())})},setup(){const t=_(),s=v(),u=f([{branchId:0,address:""}]),p=w(!0),n=f({branchId:0,employee:{surname:null,name:null,patronymic:null,isWork:!0},photo:null});return{data:n,submitForm:async o=>{await fetch("/api/masters",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)}).then(async l=>{const a=await l.json();a.message=="OK"?(s.success("Запись успешно добавлена"),t.push({name:"dashboard.masters"})):a.message=="DUPLICATION"||a.message=="DUPLICATION"?s.error("Дублирование записи"):a.message=="NOT CHANGED"?s.info("Внесите изменения"):a.message=="DATA NOT VALID"||a.status==400?s.error("Введите значения"):s.error("Ошибка при добавлении записи")}).catch(l=>t.push({name:"dashboard"}))},getBase64:o=>{let l=o.files[0];var a=new FileReader;a.readAsDataURL(l),a.onload=function(){let i=a.result.split(";"),g=i[0];["data:image/jpeg","data:image/png","data:image/jpg"].indexOf(g)!=-1?(n.photo=i[1].replace("base64,",""),document.getElementById("image").src=a.result):(o.value=null,s.error("Недопустимый тип файла"))},a.onerror=function(i){console.log("Error: ",i)}},branches:u,showBranch:p}}}),$=e("div",{class:"flex-column"},[e("h1",{class:"row h3"}," Добавить запись сотрудника ")],-1),M={class:"col-3"},P={class:"row form-group mt-3"},R=e("img",{width:"300px",height:"300px",src:"https://imgholder.ru/300X300/8493a8/adb9ca&font=kelson",id:"image"},null,-1),W=e("label",{class:"h5"},"Изображение",-1),H={class:"input-group mb-3"},J=e("label",{class:"input-group-text"},"Загрузка",-1),K={key:0,class:"row form-group mt-3"},z=e("label",{class:"h5"},"Филиал",-1),G={class:"col-12"},X=["value"],q={class:"row form-group mt-3"},Q=e("label",{class:"h5"},"Фамилия",-1),Y={class:"col-12"},Z={class:"row form-group mt-3"},ee=e("label",{class:"h5"},"Имя",-1),se={class:"col-12"},te={class:"row form-group mt-3"},oe=e("label",{class:"h5"},"Отчество",-1),ae={class:"col-12"},ue={class:"form-check mt-3"},re=e("label",{class:"form-check-label h5",for:"flexCheckDefault"}," Работает ",-1),ne={class:"row mt-4"},le=e("button",{type:"submit",class:"btn btn-success me-3",style:{width:"120px"}},"Сохранить",-1);function ie(t,s,u,p,n,b){const h=I("router-link");return d(),c("div",null,[$,e("form",{onSubmit:s[6]||(s[6]=U((...o)=>t.submitForm&&t.submitForm(...o),["prevent"])),class:"row mt-3"},[e("div",M,[e("div",P,[R,W,e("div",H,[e("input",{type:"file",class:"form-control",onChange:s[0]||(s[0]=o=>{o.target.files.length>0&&t.getBase64(o.target)})},null,32),J])]),t.showBranch?(d(),c("div",K,[z,e("div",G,[r(e("select",{class:"form-control","onUpdate:modelValue":s[1]||(s[1]=o=>t.data.branchId=o)},[(d(!0),c(k,null,B(t.branches,o=>(d(),c("option",{value:o.branchId},F(o.address),9,X))),256))],512),[[D,t.data.branchId]])])])):T("",!0),e("div",q,[Q,e("div",Y,[r(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=o=>t.data.employee.surname=o),class:"form-control",placeholder:"Введите адрес"},null,512),[[m,t.data.employee.surname]])])]),e("div",Z,[ee,e("div",se,[r(e("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=o=>t.data.employee.name=o),class:"form-control",placeholder:"Введите адрес"},null,512),[[m,t.data.employee.name]])])]),e("div",te,[oe,e("div",ae,[r(e("input",{type:"text","onUpdate:modelValue":s[4]||(s[4]=o=>t.data.employee.patronymic=o),class:"form-control",placeholder:"Введите адрес"},null,512),[[m,t.data.employee.patronymic]])])]),e("div",ue,[re,r(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=o=>t.data.employee.isWork=o),id:"flexCheckDefault"},null,512),[[A,t.data.employee.isWork]])]),e("div",ne,[le,E(h,{tag:"button",to:{name:"dashboard.masters"},type:"submit",class:"btn btn-secondary",style:{width:"120px"}},{default:O(()=>[N("Назад")]),_:1})])])],32)])}const pe=C(L,[["render",ie]]);export{pe as default};
