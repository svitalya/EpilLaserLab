import{d as h,u as f,b as g,a as c,_ as b,g as _,o as y,c as v,e,w,v as C,h as T,p as D,m as B,y as I}from"./index-1Nx-P1XQ.js";import{D as O,I as x,O as E}from"./style-DmTOC_lk.js";const F=h({components:{DataTable:O,TableBody:x,TableHead:E},async beforeCreate(){await fetch(`/api/branches/${this.id}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then(async s=>{let t=await s.json();if(t.message!="OK"){this.toast.error("Ошибка при получении записи");return}let o=t.rec;this.dataImg.imgSrc=`/resources/images/${o.photoPath}`,this.data.address=o.address}),this.$forceUpdate()},setup(){const s=f(),t=s.currentRoute.value.params.id,o=g(),l=c({imgSrc:"https://imgholder.ru/300X300/8493a8/adb9ca&font=kelson"}),r=c({address:null,photoFile:null});return{data:r,submitForm:async u=>{await fetch(`/api/branches/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(r)}).then(async n=>{const a=await n.json();a.message=="OK"?(o.success("Запись успешно изменена"),s.push({name:"dashboard.branches"})):a.message=="DUPLICATION"?o.error("Дублирование записи"):a.message=="NOT CHANGED"?o.info("Внесите изменения"):a.message=="DATA NOT VALID"||a.status==400?o.error("Введите значения"):o.error("Ошибка при изменении записи")}).catch(n=>s.push({name:"dashboard"}))},getBase64:u=>{let n=u.files[0];var a=new FileReader;a.readAsDataURL(n),a.onload=function(){let i=a.result.split(";"),p=i[0];["data:image/jpeg","data:image/png","data:image/jpg"].indexOf(p)!=-1?(r.photoFile=i[1].replace("base64,",""),document.getElementById("image").src=a.result):(u.value=null,o.error("Недопустимый тип файла"))},a.onerror=function(i){console.log("Error: ",i)}},id:t,dataImg:l}}}),N=e("div",{class:"flex-column"},[e("h1",{class:"row h3"}," Изменить запись филиала ")],-1),$={class:"col-3"},A={class:"row form-group mt-3"},j=["src"],k=e("label",{class:"h5"},"Изображение",-1),S={class:"input-group mb-3"},U=e("label",{class:"input-group-text"},"Загрузка",-1),V={class:"row form-group mt-3"},R=e("label",{class:"h5"},"Адрес",-1),L={class:"col-12"},P={class:"row mt-4"},G=e("button",{type:"submit",class:"btn btn-success me-3",style:{width:"120px"}},"Сохранить",-1);function H(s,t,o,l,r,m){const d=_("router-link");return y(),v("div",null,[N,e("form",{onSubmit:t[2]||(t[2]=B((...u)=>s.submitForm&&s.submitForm(...u),["prevent"])),class:"row mt-3"},[e("div",$,[e("div",A,[e("img",{width:"300px",height:"300px",src:s.dataImg.imgSrc,id:"image"},null,8,j),k,e("div",S,[e("input",{type:"file",class:"form-control",onChange:t[0]||(t[0]=u=>{u.target.files.length>0&&s.getBase64(u.target)})},null,32),U])]),e("div",V,[R,e("div",L,[w(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=u=>s.data.address=u),class:"form-control",placeholder:"Введите адрес"},null,512),[[C,s.data.address]])])]),e("div",P,[G,T(d,{tag:"button",to:{name:"dashboard.branches"},type:"submit",class:"btn btn-secondary",style:{width:"120px"}},{default:D(()=>[I("Назад")]),_:1})])])],32)])}const M=b(F,[["render",H]]);export{M as default};
