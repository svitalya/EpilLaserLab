import{d as O,s as w,u as L,r as v,_ as $,e as f,o as j,j as x,m as l,f as n,x as m,t as g,a as k}from"./index-DjdE6vYD.js";import{I as F,O as I,D as N}from"./style-DaQOmh4s.js";const K=O({components:{TableBody:F,TableHead:I,DataTable:N},setup(){const t=w(),i=L(),b=v([]),s=v({}),d=v({}),C=a=>a.target.parentNode.dataset.id,c=async a=>{let e=C(a);await t.push({name:"dashboard.purchased-season-tickets.edit",params:{id:e}})},h=async a=>{if(!confirm("Вы точно хотите удалить запись?"))return;let o=C(a);await fetch(`/api/purchasedseasontickets/${o}`,{method:"DELETE",credentials:"include"}).then(async u=>{const p=await u.json();p.message=="OK"?(i.success("Запись удалена"),r(void 0)):p.message=="BLOCK"?i.error("Удаление записи приведет к потере данных"):i.error("Ошибка при удалении записи")}).catch(u=>t.push({name:"dashboard"}))},r=async a=>{let e,o,u,p;u=d.value.sort,typeof a=="string"?(e=s.value.page,o=s.value.limit,u=="asc"?u="desc":u="asc"):typeof a==typeof{}?(e=a.page-1<0?0:a.page-1,o=a.per_page,p=a.search):(e=s.value.page,o=s.value.limit);let S={page:e,limit:o,sort:u,search:p};var B=new URLSearchParams(S);await fetch(`/api/purchasedseasontickets?${B}`,{headers:{"Content-Type":"application/json"},credentials:"include"}).then(async y=>{let _=await y.json();if(_.message="OK"){let D=_.data,T=D.max;e=D.page;let E=D.recs;b.value=E,s.value={...s.value,page:e,total:T,limit:o},d.value={...d.value,sort:u}}else b.value=[],s.value={...s.value,page:0,total:0,limit:o},d.value={...d.value,sort:u}}).catch(y=>t.push({name:"dashboard"}))};return{tableData:b,pagination:s,loadData:r,sort:d,delClick:h,editClick:c}}}),V=k("TableBodyCell",{class:"d-flex justify-content-center",colspan:"5"}," Нет записей ",-1);function R(t,i,b,s,d,C){const c=f("table-head"),h=f("router-link"),r=f("table-body"),a=f("data-table");return j(),x(a,{rows:t.tableData,pagination:t.pagination,sort:t.sort,striped:"",onLoadData:t.loadData,style:{"font-size":"large !important"}},{thead:l(()=>[n(c,{sortable:"name",onSorting:t.loadData},{default:l(()=>[m("Услуга")]),_:1},8,["onSorting"]),n(c,{sortable:"client",onSorting:t.loadData},{default:l(()=>[m("Клиент")]),_:1},8,["onSorting"]),n(c,{sortable:"remains",onSorting:t.loadData},{default:l(()=>[m("Оставшиеся посещения")]),_:1},8,["onSorting"]),n(c,{sortable:"dateOfCombustion",onSorting:t.loadData},{default:l(()=>[m("Дата сгорания")]),_:1},8,["onSorting"]),n(c,null,{default:l(()=>[n(h,{to:{name:"dashboard.purchased-season-tickets.add"},tag:"button",type:"button",class:"btn btn-success"},{default:l(()=>[m("Добавить")]),_:1})]),_:1})]),tbody:l(({row:e})=>[n(r,{textContent:g(e.name)},null,8,["textContent"]),n(r,{textContent:g(e.client)},null,8,["textContent"]),n(r,{textContent:g(e.remains)},null,8,["textContent"]),n(r,{textContent:g(e.dateOfCombustionString)},null,8,["textContent"]),n(r,{"data-id":e.purchasedSeasonTicketId},{default:l(()=>[k("button",{type:"button",class:"btn btn-primary me-2",onClick:i[0]||(i[0]=(...o)=>t.editClick&&t.editClick(...o))},"ИЗМЕНИТЬ"),k("button",{type:"button",class:"btn btn-danger",onClick:i[1]||(i[1]=(...o)=>t.delClick&&t.delClick(...o))},"УДАЛИТЬ")]),_:2},1032,["data-id"])]),empty:l(()=>[V]),_:1},8,["rows","pagination","sort","onLoadData"])}const H=$(K,[["render",R]]);export{H as default};
